---
title: "penAFT Examples"
author: "Aaron J. Molstad and Piotr M. Suder"
date: "12/25/2020"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Introduction
In this document, I will detail how to use the penAFT R package with a few short examples. This is meant partly to identify bugs, and partly to serve as a self-guide going forward. 

```{r loadup, include=FALSE}
library(Rcpp)
library(evd)
library(irlba)
source("/Users/aaron/Documents/GitHub/penAFT/R/ADMM.ENpath.R")
source("/Users/aaron/Documents/GitHub/penAFT/R/ADMM.SGpath.R")
source("/Users/aaron/Documents/GitHub/penAFT/R/penAFT.R")
source("/Users/aaron/Documents/GitHub/penAFT/R/penAFT.cv.R")
sourceCpp("/Users/aaron/Documents/GitHub/penAFT/src/ADMM_ENrun.cpp")
sourceCpp("/Users/aaron/Documents/GitHub/penAFT/src/ADMM_SGrun.cpp")
```

Then, we generate data from the AFT model described in *Regularized Estimation for the Accelerated Failure Time Model*
```{r, generateData}
set.seed(1)
n <- 100
p <- 500
SigmaX <- matrix(0, nrow=p, ncol=p)
for (j in 1:p) {
  for (k in 1:p) {
    SigmaX[j,k] <- 0.9^abs(j-k)
  }
}
eo <- eigen(SigmaX)
X <- matrix(rnorm(n*p), nrow=n)%*%eo$vec%*%diag(eo$val^.5)%*%t(eo$vec)
beta <- rep(0, p)
beta[c(1,2,6)] <- 0.35
logT <- X%*%beta + rgumbel(n, loc=0, scale=1)
C <- runif(n, min(logT),  0.5*max(logT))
logY <- pmax(logT, C)
delta <- 1*(logY == logT)
```

First, let us try fitting the model with both elastic net and group lasso. 
```{r ENfit}
# fit_EN <- penAFT(X, logY, delta, alpha = 0.5, nlambda = 100, lambda.ratio.min = 0.5, tol.rel = 1e-5, quiet=FALSE)
# 
# plot(1:100, fit_EN$beta[1,], type="l", ylim=c(-max(abs(fit_EN$beta)),max(abs(fit_EN$beta))))
# for (k in 2:p) {
#   if (any(fit_EN$beta[k,]!=0)) {
#     lines(1:100, fit_EN$beta[k,])
#   }
# }
# 
# CV_EN <- penAFT.cv(X, logY, delta, alpha = 0.5, nlambda = 100, nfolds = 5, lambda.ratio.min = 0.5, tol.rel = 1e-5, quiet = FALSE)
# 
# 
# plot(CV_EN$cv.err.linPred, type="l")


# fit_Lasso <- penAFT(X, logY, delta, alpha = 1, nlambda = 100, lambda.ratio.min = 0.75, tol.rel = 1e-5, quiet=FALSE)
# 
# plot(1:100, fit_Lasso$beta[1,], type="l", ylim=c(-max(abs(fit_Lasso$beta)),max(abs(fit_Lasso$beta))))
# for (k in 2:p) {
#   if (any(fit_Lasso$beta[k,]!=0)) {
#     lines(1:100, fit_Lasso$beta[k,])
#   }
# }
# 
# CV_Lasso <- penAFT.cv(X, logY, delta, alpha = 1, nlambda = 100, lambda.ratio.min = 0.75, tol.rel = 1e-5, quiet=FALSE, nfolds = 10)
# plot(CV_Lasso$cv.err.linPred, type="l")
# 
# 
# fit_Ridge <- penAFT(X, logY, delta, alpha = 0, lambda = 10^seq(-2, 2, length=100), quiet=FALSE)
# 
# CV_Ridge <- penAFT.cv(X, logY, delta, alpha = 0, lambda = 10^seq(-2, 2, length=100), quiet=FALSE, nfolds = 10)

```








